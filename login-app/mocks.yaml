# LOGIN

- request:
    url: ^/login$
    method: POST
    post: >
      {"username":"error","password":"[^"]+"}
  response:
    headers:
      content-type: application/json
    status: 401
    latency: 150

- request:
    url: ^/login$
    method: POST
    post: >
      .*"username":"with-permissions".*
  response:
    headers:
      content-type: application/json
    status: 200
    latency: 150
    body: >
      {"grant_token": "granttokenwithpermissions", "uid": "userid00"}

- request:
    url: ^/login$
    method: POST
    post: >
      {"username":"[^"]+","password":"[^"]+"}
  response:
    headers:
      content-type: application/json
    status: 200
    latency: 150
    body: >
      {"grant_token": "<% Math.random() %>", "uid": "userid01"}

# APPLICATION

- request:
    url: ^/applications/notfound$
    method: GET
  response:
    headers:
      content-type: application/json
    status: 404
    latency: 150

- request:
    url: ^/applications/([^/]+)$
    method: GET
  response:
    headers:
      content-type: application/json
    status: 200
    latency: 150
    body: >
      {
        "name": "Aplication X",
        "scopes": [
          {
            "name": "read_bank_info",
            "description": "Allows the application to read your bank activity. Example: Read balance, read credit card expenses."
          },
          {
            "name": "perform_bank_transactions",
            "description": "Allows the application to perform transactions like payments and transfers. Attention: this will allow the application to mess with your money!"
          },
          {
            "name": "read_personal_data",
            "description": "Allows the application read your personal data like name, surname, ssn, dependents, investitor profile, etc."
          }
        ]
      }

# TOKEN

- request:
    url: ^/token$
    method: POST
    post: >
      {"scopes":\[[^\]]+\]}
    headers:
      x-grant-token: "granttokenwithpermissions"
  response:
    headers:
      content-type: application/json
    status: 200
    latency: 150
    body: >
      {"grant_token": "granttokenwithpermissions", "callback_urls": ["http://www.google.com", "http://localhost:8082/consolidate-login.html"], "access_token": "00acesstoken00"}

- request:
    url: ^/token$
    method: POST
    post: >
      {"scopes":\[[^\]]+\]}
    headers:
      x-grant-token: ".+"
  response:
    headers:
      content-type: application/json
    status: 200
    latency: 150
    body: >
      {"grant_token": "<% Math.random() %>", "callback_urls": ["http://www.google.com", "http://localhost:8082/consolidate-login.html"], "access_token": "00acesstoken00"}

- request:
    url: ^/token$
    method: POST
  response:
    headers:
      content-type: application/json
    status: 500
    latency: 150

# SCOPES

- request:
    url: ^/applications/([^/]+)/granted
    method: GET
    headers:
      x-grant-token: "granttokenwithpermissions"
  response:
    headers:
      content-type: application/json
    status: 200
    latency: 150
    body: >
      ["read_bank_info", "read_personal_data"]

- request:
    url: ^/applications/([^/]+)/granted
    method: GET
    headers:
      x-grant-token: ".+"
  response:
    headers:
      content-type: application/json
    status: 200
    latency: 150
    body: >
      []