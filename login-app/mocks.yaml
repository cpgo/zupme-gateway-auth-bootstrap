# LOGIN

- request:
    url: ^/bank/v1/login$
    method: POST
    post: >
      {"username":"error","password":"[^"]+"}
  response:
    headers:
      content-type: application/json
    status: 401
    latency: 150

- request:
    url: ^/bank/v1/login$
    method: POST
    post: >
      .*"username":"with-permissions".*
  response:
    headers:
      content-type: application/json
    status: 200
    latency: 150
    body: >
      {"grantToken": "granttokenwithpermissions", "uid": "userid00"}

- request:
    url: ^/bank/v1/login$
    method: POST
    post: >
      {"username":"[^"]+","password":"[^"]+"}
  response:
    headers:
      content-type: application/json
    status: 200
    latency: 150
    body: >
      {"grantToken": "<% Math.random() %>", "uid": "userid01"}

# APPLICATION

- request:
    url: ^/applications/notfound$
    method: GET
  response:
    headers:
      content-type: application/json
    status: 404
    latency: 150

- request:
    url: ^/applications/([^/]+)$
    method: GET
  response:
    headers:
      content-type: application/json
    status: 200
    latency: 150
    body: >
      {
        "name": "Aplication X",
        "scopes": [
          {
            "name": "read_bank_info",
            "description": "Allows the application to read your bank activity. Example: Read balance, read credit card expenses."
          },
          {
            "name": "perform_bank_transactions",
            "description": "Allows the application to perform transactions like payments and transfers. Attention: this will allow the application to mess with your money!"
          },
          {
            "name": "read_personal_data",
            "description": "Allows the application read your personal data like name, surname, ssn, dependents, investitor profile, etc."
          }
        ]
      }

# TOKEN

- request:
    url: ^/bank/v1/_oauth/authorization-code$
    method: POST
    post: >
      grantToken=granttokenwithpermissions&uid=([^&]+)&scopes=[^&]+&grantType=complete
  response:
    headers:
      content-type: application/json
    status: 200
    latency: 150
    body: >
      {
        "uid":"<% post[1] %>",
        "appKey":"allowedkey",
        "authCode":"00authcode00",
        "expiresIn":30,
        "grantToken":"granttokenwithpermissions",
        "callbackUris": [
          "http://www.google.com",
          "http://localhost:8082/consolidate-login.html",
          "http://localhost:3666/#/rest-client/oauth/consolidate-login"
        ]
      }

- request:
    url: ^/bank/v1/_oauth/authorization-code$
    method: POST
    post: >
      grantToken=granttokenwithpermissions&uid=([^&]+)&scopes=[^&]+&grantType=implicit
  response:
    headers:
      content-type: application/json
    status: 200
    latency: 150
    body: >
      {
        "uid":"<% post[1] %>",
        "appKey":"allowedkey",
        "accessToken":"00acesstoken00",
        "expiresIn":30,
        "grantToken":"granttokenwithpermissions",
        "callbackUris": [
          "http://www.google.com",
          "http://localhost:8082/consolidate-login.html",
          "http://localhost:3666/#/rest-client/oauth/consolidate-login"
        ]
      }

- request:
    url: ^/bank/v1/_oauth/authorization-code$
    method: POST
    post: >
      grantToken=([^&]+)&uid=([^&]+)&scopes=[^&]+&grantType=complete
  response:
    headers:
      content-type: application/json
    status: 200
    latency: 150
    body: >
      {
        "uid":"<% post[1] %>",
        "appKey":"allowedkey",
        "authCode":"00authcode00",
        "expiresIn":30,
        "grantToken":"<% Math.random() %>",
        "callbackUris": [
          "http://www.google.com",
          "http://localhost:8082/consolidate-login.html",
          "http://localhost:3666/#/rest-client/oauth/consolidate-login"
        ]
      }

- request:
    url: ^/bank/v1/_oauth/authorization-code$
    method: POST
    post: >
      grantToken=([^&]+)&uid=([^&]+)&scopes=[^&]+&grantType=implicit
  response:
    headers:
      content-type: application/json
    status: 200
    latency: 150
    body: >
      {
        "uid":"<% post[1] %>",
        "appKey":"allowedkey",
        "accessToken":"00acesstoken00",
        "expiresIn":30,
        "grantToken":"<% Math.random() %>",
        "callbackUris": [
          "http://www.google.com",
          "http://localhost:8082/consolidate-login.html",
          "http://localhost:3666/#/rest-client/oauth/consolidate-login"
        ]
      }

- request:
    url: ^/bank/v1/_oauth/authorization-code$
    method: POST
  response:
    headers:
      content-type: application/json
    status: 500
    latency: 150

# SCOPES

- request:
    url: ^/applications/([^/]+)/granted
    method: GET
    headers:
      x-grant-token: "granttokenwithpermissions"
  response:
    headers:
      content-type: application/json
    status: 200
    latency: 150
    body: >
      ["read_bank_info", "read_personal_data"]

- request:
    url: ^/applications/([^/]+)/granted
    method: GET
    headers:
      x-grant-token: ".+"
  response:
    headers:
      content-type: application/json
    status: 200
    latency: 150
    body: >
      []
